<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Inertia - IMU Diagnostics</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Inertia</h1>
      <p class="subtitle">IMU Sensor Diagnostics</p>
    </header>

    <!-- Permission Gate -->
    <section id="permission-gate" class="card">
      <h2>Sensor Access Required</h2>
      <p>iOS requires explicit permission to access motion sensors. Tap the button below to enable.</p>
      <button id="request-permission" class="btn-primary">Enable Motion Sensors</button>
      <p id="permission-status" class="status"></p>
    </section>

    <!-- Main Dashboard (hidden until permission granted) -->
    <main id="dashboard" class="hidden">
      
      <!-- Screen Lock Controls -->
      <section class="card">
        <h2>Screen Lock</h2>
        <div class="lock-controls">
          <button id="lock-portrait" class="btn-primary">üîí Lock Portrait & Fullscreen</button>
          <button id="exit-fullscreen" class="btn-secondary hidden">Exit Fullscreen</button>
        </div>
        <p id="lock-status" class="hint"></p>
      </section>

      <!-- Status Bar -->
      <section class="card status-card">
        <div class="status-grid">
          <div class="status-item">
            <span class="status-label">Status</span>
            <span id="sensor-status" class="status-value">Initializing...</span>
          </div>
          <div class="status-item">
            <span class="status-label">Sample Rate</span>
            <span id="sample-rate" class="status-value">-- Hz</span>
          </div>
          <div class="status-item">
            <span class="status-label">Samples</span>
            <span id="sample-count" class="status-value">0</span>
          </div>
          <div class="status-item">
            <span class="status-label">Dropped</span>
            <span id="dropped-count" class="status-value status-dropped">0</span>
          </div>
        </div>
        <p class="status-hint">‚ö†Ô∏è Scrolling/rotating may drop samples. Recording locks scroll.</p>
      </section>

      <!-- Accelerometer Data -->
      <section class="card">
        <h2>Accelerometer <span class="unit">(m/s¬≤)</span></h2>
        <div class="sensor-grid">
          <div class="sensor-axis">
            <span class="axis-label">X</span>
            <span id="accel-x" class="axis-value">--</span>
          </div>
          <div class="sensor-axis">
            <span class="axis-label">Y</span>
            <span id="accel-y" class="axis-value">--</span>
          </div>
          <div class="sensor-axis">
            <span class="axis-label">Z</span>
            <span id="accel-z" class="axis-value">--</span>
          </div>
        </div>
        <div class="sensor-meta">
          <span>Magnitude: <span id="accel-mag">--</span></span>
        </div>
      </section>

      <!-- Gyroscope Data -->
      <section class="card">
        <h2>Gyroscope <span class="unit">(rad/s)</span></h2>
        <div class="sensor-grid">
          <div class="sensor-axis">
            <span class="axis-label">Œ±</span>
            <span id="gyro-alpha" class="axis-value">--</span>
          </div>
          <div class="sensor-axis">
            <span class="axis-label">Œ≤</span>
            <span id="gyro-beta" class="axis-value">--</span>
          </div>
          <div class="sensor-axis">
            <span class="axis-label">Œ≥</span>
            <span id="gyro-gamma" class="axis-value">--</span>
          </div>
        </div>
        <div class="sensor-meta">
          <span>Magnitude: <span id="gyro-mag">--</span></span>
        </div>
      </section>

      <!-- Timing Analysis -->
      <section class="card">
        <h2>Timing Analysis</h2>
        <div class="timing-grid">
          <div class="timing-item">
            <span class="timing-label">Interval (reported)</span>
            <span id="interval-reported" class="timing-value">-- ms</span>
          </div>
          <div class="timing-item">
            <span class="timing-label">Interval (measured)</span>
            <span id="interval-measured" class="timing-value">-- ms</span>
          </div>
          <div class="timing-item">
            <span class="timing-label">Jitter (std dev)</span>
            <span id="interval-jitter" class="timing-value">-- ms</span>
          </div>
          <div class="timing-item">
            <span class="timing-label">Min / Max</span>
            <span id="interval-minmax" class="timing-value">-- / -- ms</span>
          </div>
        </div>
      </section>

      <!-- Latency Test -->
      <section class="card">
        <h2>Tap Latency Test</h2>
        <p class="hint">Hold phone in hand, tap FIRMLY. You'll hear a click when the accelerometer detects the impact - feel the delay! üîä</p>
        <div id="latency-target" class="latency-target">
          <div class="latency-target-text">TAP HERE</div>
          <div class="latency-target-sub">Hold phone, tap firmly</div>
        </div>
        <button id="test-sound" class="btn-secondary" style="margin-top: 12px;">üîä Test Sound</button>
        <div id="latency-status" class="latency-status"></div>
        <div id="latency-results" class="latency-results hidden">
          <div class="timing-grid">
            <div class="timing-item">
              <span class="timing-label">Last Tap</span>
              <span id="latency-last" class="timing-value">-- ms</span>
            </div>
            <div class="timing-item">
              <span class="timing-label">Average</span>
              <span id="latency-avg" class="timing-value">-- ms</span>
            </div>
            <div class="timing-item">
              <span class="timing-label">Min</span>
              <span id="latency-min" class="timing-value">-- ms</span>
            </div>
            <div class="timing-item">
              <span class="timing-label">Max</span>
              <span id="latency-max" class="timing-value">-- ms</span>
            </div>
          </div>
          <p class="latency-count">Successful taps: <span id="latency-tap-count">0</span></p>
          <button id="reset-latency" class="btn-secondary">Reset</button>
        </div>
      </section>

      <!-- Theremin -->
      <section class="card theremin-card">
        <h2>üéµ Theremin</h2>
        <p class="hint">Roll (left/right) = pitch, Tilt (forward/back) = volume</p>
        
        <button id="theremin-toggle" class="btn-primary theremin-btn">‚ñ∂ Start Theremin</button>
        
        <div id="theremin-display" class="theremin-display hidden">
          <div class="theremin-viz">
            <canvas id="theremin-canvas" width="300" height="150"></canvas>
          </div>
          <div class="theremin-info">
            <div class="theremin-param">
              <span class="param-label">Note</span>
              <span id="theremin-note" class="param-value">--</span>
            </div>
            <div class="theremin-param">
              <span class="param-label">Frequency</span>
              <span id="theremin-freq" class="param-value">-- Hz</span>
            </div>
            <div class="theremin-param">
              <span class="param-label">Volume</span>
              <span id="theremin-vol" class="param-value">--%</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Orientation (Stable!) -->
      <section class="card">
        <h2>Orientation (Stable!) ‚≠ê</h2>
        <p class="hint">Uses gravity as reference - no drift for pitch/roll! Perfect for theremin.</p>
        
        <div class="orientation-values">
          <div class="orientation-value-item">
            <span class="orientation-color" style="background: #f472b6;"></span>
            <span class="orientation-label">Pitch</span>
            <span id="orient-pitch" class="orientation-number">--¬∞</span>
          </div>
          <div class="orientation-value-item">
            <span class="orientation-color" style="background: #34d399;"></span>
            <span class="orientation-label">Roll</span>
            <span id="orient-roll" class="orientation-number">--¬∞</span>
          </div>
          <div class="orientation-value-item">
            <span class="orientation-color" style="background: #60a5fa;"></span>
            <span class="orientation-label">Yaw</span>
            <span id="orient-yaw" class="orientation-number">--¬∞</span>
          </div>
        </div>
        
        <div class="graph-container">
          <canvas id="orientation-graph" width="400" height="200"></canvas>
        </div>
        
        <button id="reset-orientation" class="btn-secondary">Set Current as Zero</button>
      </section>

      <!-- Position Integration -->
      <section class="card">
        <h2>Position Integration (Experimental)</h2>
        <p class="hint">Double-integrates acceleration to estimate position. Press Reset, move phone, see trajectory. Warning: drifts quickly!</p>
        
        <div class="integration-controls">
          <button id="reset-integration" class="btn-primary">üîÑ Reset Position</button>
          <label class="checkbox-label">
            <input type="checkbox" id="integration-active" checked>
            Integration Active
          </label>
        </div>
        
        <div id="gravity-display" class="gravity-display">
          <span class="gravity-label">Gravity estimate:</span>
          <span id="gravity-values" class="gravity-values">Not calibrated</span>
        </div>
        
        <div class="position-display">
          <div class="position-grid">
            <div class="position-item">
              <span class="position-label">X</span>
              <span id="pos-x" class="position-value">0.00 m</span>
            </div>
            <div class="position-item">
              <span class="position-label">Y</span>
              <span id="pos-y" class="position-value">0.00 m</span>
            </div>
            <div class="position-item">
              <span class="position-label">Z (Height)</span>
              <span id="pos-z" class="position-value">0.00 m</span>
            </div>
          </div>
        </div>
        
        <div class="graph-container">
          <h3>Height (Z) Over Time</h3>
          <canvas id="height-graph" width="400" height="150"></canvas>
        </div>
        
        <div class="graph-container">
          <h3>XY Position (Top View)</h3>
          <canvas id="xy-graph" width="300" height="300"></canvas>
        </div>
      </section>

      <!-- Noise Analysis (when stationary) -->
      <section class="card">
        <h2>Noise Analysis</h2>
        <p class="hint">Place phone flat and still for accurate readings</p>
        <button id="measure-noise" class="btn-secondary">Measure Noise (3s)</button>
        <div id="noise-results" class="noise-results hidden">
          <div class="noise-grid">
            <div class="noise-item">
              <span class="noise-label">Accel Noise (œÉ)</span>
              <span id="accel-noise" class="noise-value">--</span>
            </div>
            <div class="noise-item">
              <span class="noise-label">Gyro Noise (œÉ)</span>
              <span id="gyro-noise" class="noise-value">--</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Recording Controls -->
      <section class="card">
        <h2>Recording</h2>
        <div class="recording-controls">
          <button id="start-recording" class="btn-primary">Start Recording</button>
          <button id="stop-recording" class="btn-secondary hidden">Stop Recording</button>
          <button id="export-csv" class="btn-secondary hidden">Export CSV</button>
          <button id="export-json" class="btn-secondary hidden">Export JSON</button>
        </div>
        <div id="recording-status" class="recording-status hidden">
          <span class="recording-indicator"></span>
          <span>Recording: <span id="recording-count">0</span> samples</span>
        </div>
      </section>

      <!-- API Info -->
      <section class="card">
        <h2>API Information</h2>
        <div class="api-info">
          <div class="api-item">
            <span class="api-label">DeviceMotionEvent</span>
            <span id="api-devicemotion" class="api-value">--</span>
          </div>
          <div class="api-item">
            <span class="api-label">DeviceOrientationEvent</span>
            <span id="api-deviceorientation" class="api-value">--</span>
          </div>
          <div class="api-item">
            <span class="api-label">Generic Sensor API</span>
            <span id="api-genericsensor" class="api-value">--</span>
          </div>
          <div class="api-item">
            <span class="api-label">User Agent</span>
            <span id="api-useragent" class="api-value api-useragent">--</span>
          </div>
        </div>
      </section>

    </main>

    <footer>
      <p>Inertia IMU Diagnostics ‚Ä¢ <a href="https://github.com/ShaiRosenblit/inertia">GitHub</a></p>
      <p class="version">Build: 2026-01-28 14:46 IST</p>
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>

